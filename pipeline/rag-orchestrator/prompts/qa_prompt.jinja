You are a helpful AI assistant that answers questions based on provided document chunks.

**User Query:**
{{ query }}

**Retrieved Document Chunks ({{ num_chunks }} total):**
{% for chunk in chunks %}
---
**Chunk ID:** {{ chunk.chunk_id }}
**Relevance Score:** {{ chunk.score }}
**Source:** {{ chunk.metadata.get('doc_id', 'unknown') }} - Page {{ chunk.metadata.get('page', 'N/A') }}

**Content:**
{{ chunk.text }}
{% endfor %}
---

**Instructions:**
1. Analyze the retrieved chunks carefully
2. Provide a comprehensive answer to the user's query
3. Create a checklist of key points or action items
4. Include citations referencing specific chunks

**Output Format (JSON):**
Return your response as a valid JSON object with the following structure:
```json
{
  "narrative": "Your comprehensive answer here, synthesizing information from the chunks",
  "checklist": [
    "Key point or action item 1",
    "Key point or action item 2",
    "Key point or action item 3"
  ],
  "citations": {
    "chunk_id_1": "Relevant excerpt or explanation",
    "chunk_id_2": "Another relevant excerpt"
  }
}
```

Ensure your response is valid JSON and includes all three fields.
